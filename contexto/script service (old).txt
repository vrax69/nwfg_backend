Perfecto. AquÃ­ tienes un **resumen tÃ©cnico, profundo, documentable y completo** del microservicio **`graphql-scripts`**, su razÃ³n de existir, arquitectura, diseÃ±o, decisiones tÃ©cnicas, flujos, casos de uso y propÃ³sito dentro del ecosistema NWFG.

---

# ğŸ“˜ **DOCUMENTACIÃ“N â€“ Microservicio `graphql-scripts`**

## ğŸ§  **RazÃ³n y JustificaciÃ³n del Microservicio**

El microservicio **graphql-scripts** nace para resolver una necesidad crÃ­tica en NWFG:

> **Centralizar y gestionar dinÃ¡micamente los scripts (guiones) utilizados por agentes para ventas, TPV y flujo de enrolamiento**, permitiendo ediciÃ³n, actualizaciÃ³n, versionamiento y consumo desde el frontend sin afectar la estructura del resto del sistema.

Antes existÃ­an guiones estÃ¡ticos en archivos PDF/Word/Notion â†’ esto provocaba:

| Problema                                   | Consecuencia                                      |
| ------------------------------------------ | ------------------------------------------------- |
| versiones manuales                         | informaciÃ³n desactualizada en plataformas         |
| no existe estructura editable              | difÃ­cil modificar una secciÃ³n sin romper el resto |
| los agentes usan scripts distintos         | falta de estandarizaciÃ³n en venta                 |
| cambios tardan horas/dÃ­as en implementarse | riesgo legal/comercial                            |

### ğŸ”¥ Objetivo del microservicio

Crear un backend capaz de:

* almacenar scripts con estructura dinÃ¡mica por **secciones**
* permitir ediciÃ³n desde panel en tiempo real
* versionamiento interno y trazabilidad de cambios
* exponer la informaciÃ³n por **GraphQL**
* validar acceso mediante autenticaciÃ³n JWT
* servir contenido para TPV + CRM + entrenamiento IA

---

## ğŸ— **DiseÃ±o y Arquitectura**

### ğŸ“Œ Stack TecnolÃ³gico

| Componente     | TecnologÃ­a                             |
| -------------- | -------------------------------------- |
| Lenguaje       | Node.js ES Modules                     |
| API Layer      | **GraphQL (Apollo Server standalone)** |
| DB Engine      | MySQL                                  |
| ORM/Driver     | mysql2 pool                            |
| Auth           | JWT vÃ­a microservicio `user-auth`      |
| MonitorizaciÃ³n | PM2                                    |
| Consumo        | Frontend Next.js + futuro mobile/AI    |

### ğŸ“‚ Estructura del Proyecto

```
graphql-scripts/
â”‚ .env
â”‚ package.json
â”‚ README.md
â””â”€â”€ src/
    â”œâ”€â”€ index.js          â†’ servidor Apollo + middlewares
    â”œâ”€â”€ db.js             â†’ conexiÃ³n MySQL pool
    â”œâ”€â”€ schema.js         â†’ tipos y modelos GraphQL
    â”œâ”€â”€ resolvers.js      â†’ lÃ³gica de queries/mutations
    â”œâ”€â”€ scriptsDynamic/   â†’ futuras plantillas dinÃ¡micas
    â””â”€â”€ users/            â†’ validaciones con auth
```

### ğŸ” Seguridad y Promesas del DiseÃ±o

| Feature                        | Estado                       |
| ------------------------------ | ---------------------------- |
| AutenticaciÃ³n vÃ­a token Bearer | âœ” conectado a `auth-service` |
| `SKIP_AUTH` modo test          | âœ” control por ENV            |
| Roles (admin, editor, lectura) | âŸ³ para implementar           |
| AuditorÃ­a / track de cambios   | âœ” vÃ­a DB y logs              |

```env
PORT=3005
AUTH_SERVICE_URL=https://nwfg.net/api/auth/verify
SKIP_AUTH=0
DB_HOST=localhost
DB_USER=admin
DB_PASSWORD=***
DB_NAME=scripts_db
```

---

## ğŸ—„ Estructura de Datos en Base de Datos

Base `scripts_db`:

| Tabla             | Finalidad                                           |
| ----------------- | --------------------------------------------------- |
| `scripts`         | Contiene los guiones base (id, nombre, descripciÃ³n) |
| `script_sections` | Secciones del script (orden, contenido editable)    |
| `script_versions` | Historial y cambios                                 |
| `users_edits`     | Trazabilidad de ediciones (quiÃ©n, cuÃ¡ndo)           |

Ejemplo tabla `script_sections`:

| id | script_id | section_name | content | order_index |
| -- | --------- | ------------ | ------- | ----------- |

Permite editar cada parte individualmente, sin romper el script completo.

---

## ğŸ”— ComunicaciÃ³n entre microservicios

```
Frontend <--GraphQL--> graphql-scripts <--REST--> user-auth
                            |
                          MySQL
```

* El frontend consulta secciones, crea nuevas, edita contenido, reordena.
* Todos los cambios quedan centralizados y sincronizados en tiempo real.
* `user-auth` valida identidad mediante token â†’ returned user context.

---

## ğŸ“¤ Endpoints (via GraphQL)

### Query ejemplo (obtener secciones)

```graphql
query {
  scriptSections(script_id: 1) {
    section_id
    section_name
    content
  }
}
```

### Mutation ejemplo (editar texto)

```graphql
mutation {
  updateSection(id: 10, content:"Nuevo contenido actualizado") {
    success
    message
  }
}
```

---

## ğŸš€ Casos de Uso Reales

| Caso                                             | Impacto                          |
| ------------------------------------------------ | -------------------------------- |
| equipo cambia texto legal â†’ producciÃ³n inmediato | elimina PDFs antiguos            |
| crear variaciÃ³n para estado o proveedor          | multi-script sin duplicar lÃ³gica |
| agentes visualizan la Ãºltima versiÃ³n en TPV      | mejora compliance y ventas       |
| backend IA podrÃ¡ leer guiones dinÃ¡micos          | entrenamiento conversacional     |

---

## ğŸ“Œ VisiÃ³n futura

* Editor avanzado estilo Notion/Google Docs
* Historico y revert cambios
* Scripts parametrizados (estado, utility, plan)
* Asistente IA que genera secciones
* ExportaciÃ³n a PDF y plantillas para callcenter

---

## ConclusiÃ³n Final

El microservicio **graphql-scripts** existe para convertir el guion operativo
de ventas en un **sistema dinÃ¡mico, versionado, editable, seguro y centralizado**,
abriendo puertas a automatizaciÃ³n, IA comercial y escalabilidad del flujo operativo
de NWFG.

> Es el nÃºcleo que garantizarÃ¡ que todos en la organizaciÃ³n hablen **el mismo script**, actualizado y controlado en tiempo real.

---

Si deseas, puedo continuar con:

ğŸ“„ **documento PDF/WORD completo de arquitectura**
ğŸ“Œ **diagramas UML** (casos de uso + secuencia + entidad-relaciÃ³n)
ğŸ–¥ **generar UI base del editor en Next.js + Hooks + Apollo**

Â¿Quieres que te arme tambiÃ©n el **diagrama visual arquitectÃ³nico**?
